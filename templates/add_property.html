{% extends "layout.html" %}
{% block title %}Add Property – Property Planner{% endblock %}
{% block content %}
  <h1 class="page-title">Add New Property</h1>
  <form action="/properties/add" method="post" class="form">
    <div class="form-group">
      <label for="name">Name</label>
      <input type="text" id="name" name="name" required />
    </div>
    <div class="form-group">
      <label for="value">Value (£)</label>
      <input
        type="number"
        id="value"
        name="value"
        step="0.01"
        min="0"
        required
      />
    </div>
    <div class="form-group">
      <label for="type">Type</label>
      <select id="type" name="type" required>
        <option value="personal">Personal</option>
        <option value="company">Company</option>
      </select>
    </div>
    <div class="form-group">
      <label for="postcode">Postcode</label>
      <input type="text" id="postcode" placeholder="Enter postcode" />
    </div>
    <div class="form-group">
      <label for="address">Address</label>
      <select id="address" name="address">
        <option value="">Select an address</option>
      </select>
    </div>
    <button type="submit" class="btn">Add Property</button>
  </form>
  <script>
    const GET_ADDRESS_API_KEY = "PASTE_YOUR_API_KEY_HERE"; // Replace with your API key
    document
      .getElementById("postcode")
      .addEventListener("change", async function () {
        const postcode = this.value.trim();
        const addressSelect = document.getElementById("address");
        addressSelect.innerHTML = '<option value="">Loading...</option>';
        if (!postcode) {
          addressSelect.innerHTML = '<option value="">Select an address</option>';
          return;
        }
        try {
          const response = await fetch(
            `https://api.getAddress.io/find/${encodeURIComponent(
              postcode
            )}?api-key=${GET_ADDRESS_API_KEY}`
          );
          if (!response.ok) {
            throw new Error("Lookup failed");
          }
          const data = await response.json();
          addressSelect.innerHTML = "";
          data.addresses.forEach((addr) => {
            const option = document.createElement("option");
            option.value = addr;
            option.textContent = addr;
            addressSelect.appendChild(option);
          });
        } catch (err) {
          addressSelect.innerHTML = '<option value="">No addresses found</option>';
        }
      });
  </script>
{% endblock %}
